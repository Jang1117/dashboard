<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jang's Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f0f0f;
            --bg-secondary: #1a1a1a;
            --bg-card: #222222;
            --bg-hover: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-muted: #666666;
            --accent: #4ecdc4;
            --accent-hover: #45b7aa;
            --border: #333333;
            --success: #4ade80;
            --warning: #fbbf24;
            --danger: #f87171;
            --memo-yellow: #fef3c7;
            --memo-pink: #fce7f3;
            --memo-blue: #dbeafe;
            --memo-green: #d1fae5;
            --memo-purple: #ede9fe;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            line-height: 1.6;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 30px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header h1 {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--accent);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .current-time {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        /* Weather in Header */
        .weather-inline {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-card);
            padding: 8px 16px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .weather-icon { font-size: 1.5rem; }
        .weather-temp { font-size: 1.2rem; font-weight: 600; }
        .weather-desc { font-size: 0.85rem; color: var(--text-secondary); }
        .weather-location { font-size: 0.75rem; color: var(--text-muted); }

        /* Main Layout */
        .main-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
            gap: 16px;
            padding: 16px 30px;
            max-width: 1600px;
            margin: 0 auto;
            height: calc(100vh - 70px);
        }

        /* Card Base */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 14px;
            transition: all 0.3s ease;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .card:hover {
            border-color: var(--accent);
            box-shadow: 0 0 30px rgba(78, 205, 196, 0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }

        .card-title {
            font-size: 1rem; font-weight: 600; color: var(--text-primary);
            display: flex; align-items: center; gap: 8px;
        }

        .card-title-icon { color: var(--accent); }

        .card-actions { display: flex; gap: 6px; align-items: center; }

        .card-btn {
            background: var(--bg-hover); border: 1px solid var(--border);
            color: var(--text-secondary); padding: 5px 10px; border-radius: 6px;
            cursor: pointer; font-size: 0.8rem; transition: all 0.2s;
        }

        .card-btn:hover { background: var(--accent); color: var(--bg-primary); border-color: var(--accent); }

        /* Bookmarks Grouped Style */
        .bookmarks-container {
            flex: 1;
            overflow-y: auto;
            padding-right: 4px;
        }

        .bookmark-group {
            margin-bottom: 16px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 10px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .group-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--accent);
            cursor: pointer;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .group-title:hover { background: var(--bg-hover); }

        .bookmarks-grid-inner {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 8px;
        }

        .bookmark-item {
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 8px;
            padding: 8px 10px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: var(--text-primary);
            position: relative;
            height: 42px;
        }

        .bookmark-item:hover {
            background: var(--bg-hover);
            transform: translateY(-2px);
            border-color: var(--accent);
        }

        .bookmark-icon {
            width: 24px; height: 24px; min-width: 24px;
            background: var(--bg-hover); border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.9rem;
        }

        .bookmark-name {
            font-size: 0.75rem; color: var(--text-secondary);
            overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1;
        }

        /* Fixed: Bookmark delete button inside container */
        .bookmark-delete {
            position: absolute;
            top: 2px;
            right: 2px;
            width: 16px;
            height: 16px;
            background: var(--danger);
            border: none;
            border-radius: 4px;
            color: white;
            font-size: 10px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 5;
        }

        .bookmark-item:hover .bookmark-delete { display: flex; }

        /* Calendar, Memo, News styles remain same but optimized for space */
        .week-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; margin-bottom: 10px; }
        .week-day { text-align: center; padding: 6px 4px; background: var(--bg-secondary); border-radius: 6px; cursor: pointer; transition: all 0.2s; border: 2px solid transparent; }
        .week-day.today { background: var(--accent); color: var(--bg-primary); }
        .week-day.selected { border-color: var(--accent); background: rgba(78, 205, 196, 0.15); }
        .week-day-name { font-size: 0.7rem; color: var(--text-muted); }
        .week-day-num { font-size: 1rem; font-weight: 600; }
        .event-dot { width: 5px; height: 5px; border-radius: 50%; background: var(--accent); }

        .memo-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; overflow-y: auto; padding: 4px; }
        .memo-postit { background: var(--memo-yellow); border-radius: 4px; padding: 10px; min-height: 90px; cursor: pointer; transition: all 0.2s; position: relative; box-shadow: 2px 2px 8px rgba(0,0,0,0.3); display: flex; flex-direction: column; overflow: hidden; }
        .memo-postit.yellow { background: var(--memo-yellow); }
        .memo-postit.pink { background: var(--memo-pink); }
        .memo-postit.blue { background: var(--memo-blue); }
        .memo-postit.green { background: var(--memo-green); }
        .memo-postit.purple { background: var(--memo-purple); }
        .memo-postit-title { font-size: 0.8rem; font-weight: 600; color: #333; }
        .memo-postit-content { font-size: 0.7rem; color: #444; flex: 1; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }

        .news-keyword-bar { display: flex; gap: 5px; margin-bottom: 8px; flex-wrap: wrap; }
        .news-keyword { background: var(--bg-secondary); border: 1px solid var(--border); padding: 4px 12px; border-radius: 16px; font-size: 0.8rem; color: var(--text-secondary); cursor: pointer; }
        .news-keyword.active { background: var(--accent); color: var(--bg-primary); }
        .news-item { display: flex; justify-content: space-between; align-items: center; gap: 10px; padding: 6px 10px; background: var(--bg-secondary); border-radius: 5px; margin-bottom: 4px; text-decoration: none; border: 1px solid transparent; }
        .news-title { color: var(--text-primary); font-size: 0.78rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; }

        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 24px; width: 90%; max-width: 500px; }
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; margin-bottom: 6px; color: var(--text-secondary); font-size: 0.85rem; }
        .form-input, .form-textarea, .form-select { width: 100%; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; color: var(--text-primary); font-size: 0.9rem; }
        .form-submit { width: 100%; background: var(--accent); border: none; color: var(--bg-primary); padding: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; }

        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-left">
            <h1>Jang's Dashboard</h1>
        </div>
        <div class="header-right">
            <div class="weather-inline" id="weatherWidget">
                <span class="weather-icon" id="weatherIcon">üå°Ô∏è</span>
                <div>
                    <span class="weather-temp" id="weatherTemp">--¬∞</span>
                    <span class="weather-desc" id="weatherDesc">Î°úÎî©Ï§ë...</span>
                </div>
                <span class="weather-location" id="weatherLocation">üìç --</span>
            </div>
            <div class="current-time" id="currentTime">00:00:00</div>
            <button class="settings-btn" style="background:none; border:none; cursor:pointer; font-size:1.2rem;" onclick="exportToJson()">üì•</button>
        </div>
    </header>

    <main class="main-container">
        <div class="card">
            <div class="card-header">
                <div class="card-title"><span class="card-title-icon">‚≠ê</span> Ï¶êÍ≤®Ï∞æÍ∏∞</div>
                <div class="card-actions">
                    <button class="card-btn" onclick="addGroup()">+ Í∑∏Î£π</button>
                </div>
            </div>
            <div class="bookmarks-container" id="bookmarksGrid"></div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title"><span class="card-title-icon">üìÖ</span> Ï£ºÍ∞Ñ ÏùºÏ†ï</div>
                <div class="card-actions"><button class="card-btn" onclick="openAddEventModal()">+ ÏùºÏ†ï</button></div>
            </div>
            <div class="week-grid" id="weekGrid"></div>
            <div id="selectedDateHeader" style="font-size:0.8rem; color:var(--text-muted); margin-bottom:8px;"></div>
            <div class="events-list" id="eventsList" style="flex:1; overflow-y:auto;"></div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title"><span class="card-title-icon">üìù</span> Î©îÎ™®</div>
                <div class="card-actions"><button class="card-btn" onclick="openAddMemo()">+ Î©îÎ™®</button></div>
            </div>
            <div class="memo-grid" id="memoGrid"></div>
        </div>

        <div class="card">
            <div class="card-header">
                <div class="card-title"><span class="card-title-icon">üì∞</span> Îâ¥Ïä§</div>
                <div class="card-actions"><button class="card-btn" onclick="refreshNews()">ÏÉàÎ°úÍ≥†Ïπ®</button></div>
            </div>
            <div class="news-keyword-bar" id="newsKeywords"></div>
            <div class="news-list" id="newsList" style="flex:1; overflow-y:auto;"></div>
        </div>
    </main>

    <div class="modal-overlay" id="bookmarkModal">
        <div class="modal">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h2 style="font-size:1.1rem;">Ï¶êÍ≤®Ï∞æÍ∏∞ Ï∂îÍ∞Ä</h2>
                <button onclick="closeModal('bookmarkModal')" style="background:none; border:none; color:white; cursor:pointer; font-size:1.5rem;">√ó</button>
            </div>
            <form onsubmit="addBookmark(event)">
                <div class="form-group">
                    <label class="form-label">Í∑∏Î£π ÏÑ†ÌÉù</label>
                    <select class="form-select" id="bookmarkGroupSelect"></select>
                </div>
                <div class="form-group">
                    <label class="form-label">ÏÇ¨Ïù¥Ìä∏ Ïù¥Î¶Ñ</label>
                    <input type="text" class="form-input" id="bookmarkName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">URL</label>
                    <input type="url" class="form-input" id="bookmarkUrl" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Ïù¥Î™®ÏßÄ ÏïÑÏù¥ÏΩò</label>
                    <input type="text" class="form-input" id="bookmarkIcon" placeholder="üîó" maxlength="2">
                </div>
                <button type="submit" class="form-submit">Ï†ÄÏû•ÌïòÍ∏∞</button>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="memoModal">
        <div class="modal">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h2 id="memoModalTitle" style="font-size:1.1rem;">Î©îÎ™®</h2>
                <button onclick="closeModal('memoModal')" style="background:none; border:none; color:white; cursor:pointer; font-size:1.5rem;">√ó</button>
            </div>
            <form onsubmit="saveMemo(event)">
                <input type="hidden" id="memoEditIndex" value="-1">
                <div class="form-group"><label class="form-label">Ï†úÎ™©</label><input type="text" class="form-input" id="memoTitle" required></div>
                <div class="form-group"><label class="form-label">ÎÇ¥Ïö©</label><textarea class="form-textarea" id="memoContent"></textarea></div>
                <div class="form-group">
                    <label class="form-label">ÏÉâÏÉÅ</label>
                    <select class="form-select" id="memoColorSelect">
                        <option value="yellow">Yellow</option><option value="pink">Pink</option><option value="blue">Blue</option><option value="green">Green</option>
                    </select>
                </div>
                <button type="submit" class="form-submit">Ï†ÄÏû•</button>
            </form>
        </div>
    </div>

    <script>
        let state = {
            bookmarkGroups: [
                { name: "AI ÎèÑÍµ¨", items: [{ name: 'ChatGPT', url: 'https://chat.openai.com', icon: 'ü§ñ' }, { name: 'Gemini', url: 'https://gemini.google.com', icon: '‚ú®' }] },
                { name: "Ìè¨ÌÑ∏/Îâ¥Ïä§", items: [{ name: 'Naver', url: 'https://naver.com', icon: 'üíö' }, { name: 'Google', url: 'https://google.com', icon: 'üîç' }] }
            ],
            events: [],
            memos: [],
            newsKeywords: ['IT', 'Í≤ΩÏ†ú', 'Î∂ÄÎèôÏÇ∞'],
            activeKeyword: 'IT',
            currentWeekStart: null,
            selectedDate: null
        };

        function init() {
            state.currentWeekStart = getWeekStart(new Date());
            state.selectedDate = getLocalDateStr(new Date());
            loadState();
            
            updateTime();
            setInterval(updateTime, 1000);
            getWeather();
            renderBookmarks();
            renderWeeklyCalendar();
            renderMemos();
            renderNewsKeywords();
            loadNews();
        }

        function loadState() {
            const saved = localStorage.getItem('dashboardState_v4');
            if (saved) {
                const parsed = JSON.parse(saved);
                state = { ...state, ...parsed };
            }
        }

        function saveState() {
            localStorage.setItem('dashboardState_v4', JSON.stringify(state));
        }

        // --- Bookmarks Logic ---
        function renderBookmarks() {
            const container = document.getElementById('bookmarksGrid');
            container.innerHTML = state.bookmarkGroups.map((group, gIdx) => `
                <div class="bookmark-group">
                    <div class="group-header">
                        <span class="group-title" onclick="renameGroup(${gIdx})">${group.name} ‚úèÔ∏è</span>
                        <div class="card-actions">
                            <button class="card-btn" onclick="openAddBookmarkModal(${gIdx})" style="padding:2px 6px; font-size:0.7rem;">+ Ï∂îÍ∞Ä</button>
                            <button class="card-btn" onclick="deleteGroup(${gIdx})" style="padding:2px 6px; font-size:0.7rem; color:var(--danger);">ÏÇ≠Ï†ú</button>
                        </div>
                    </div>
                    <div class="bookmarks-grid-inner">
                        ${group.items.map((b, i) => `
                            <a href="${b.url}" target="_blank" class="bookmark-item">
                                <button class="bookmark-delete" onclick="deleteBookmark(event, ${gIdx}, ${i})">√ó</button>
                                <div class="bookmark-icon">${b.icon || 'üîó'}</div>
                                <div class="bookmark-name">${b.name}</div>
                            </a>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }

        function openAddBookmarkModal(gIdx = 0) {
            const select = document.getElementById('bookmarkGroupSelect');
            select.innerHTML = state.bookmarkGroups.map((g, i) => `<option value="${i}">${g.name}</option>`).join('');
            select.value = gIdx;
            document.getElementById('bookmarkModal').classList.add('active');
        }

        function addBookmark(e) {
            e.preventDefault();
            const gIdx = document.getElementById('bookmarkGroupSelect').value;
            state.bookmarkGroups[gIdx].items.push({
                name: document.getElementById('bookmarkName').value,
                url: document.getElementById('bookmarkUrl').value,
                icon: document.getElementById('bookmarkIcon').value || 'üîó'
            });
            saveState();
            renderBookmarks();
            closeModal('bookmarkModal');
            e.target.reset();
        }

        function deleteBookmark(e, gIdx, iIdx) {
            e.preventDefault(); e.stopPropagation();
            state.bookmarkGroups[gIdx].items.splice(iIdx, 1);
            saveState();
            renderBookmarks();
        }

        function addGroup() {
            const name = prompt("ÏÉà Í∑∏Î£π Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî:");
            if (name) {
                state.bookmarkGroups.push({ name, items: [] });
                saveState();
                renderBookmarks();
            }
        }

        function renameGroup(index) {
            const newName = prompt("Í∑∏Î£π Ïù¥Î¶Ñ ÏàòÏ†ï:", state.bookmarkGroups[index].name);
            if (newName) {
                state.bookmarkGroups[index].name = newName;
                saveState();
                renderBookmarks();
            }
        }

        function deleteGroup(index) {
            if (confirm("Í∑∏Î£πÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) {
                state.bookmarkGroups.splice(index, 1);
                saveState();
                renderBookmarks();
            }
        }

        // --- Helpers ---
        function getLocalDateStr(d) { return d.toISOString().split('T')[0]; }
        function getWeekStart(date) {
            const d = new Date(date);
            d.setDate(d.getDate() - d.getDay());
            d.setHours(0,0,0,0);
            return d;
        }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }

        // --- (Other functions: Time, Weather, Calendar, News, Memo - Same as previous version) ---
        function updateTime() { document.getElementById('currentTime').textContent = new Date().toLocaleTimeString('ko-KR', { hour12: false }); }
        
        async function getWeather() {
            // Simple mock or real fetch if needed
            document.getElementById('weatherTemp').textContent = '22¬∞';
            document.getElementById('weatherDesc').textContent = 'ÎßëÏùå';
            document.getElementById('weatherLocation').textContent = 'üìç ÏÑúÏö∏';
        }

        function renderWeeklyCalendar() {
            const grid = document.getElementById('weekGrid');
            const dayNames = ['Ïùº', 'Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à', 'ÌÜ†'];
            let html = '';
            for (let i = 0; i < 7; i++) {
                const d = new Date(state.currentWeekStart);
                d.setDate(d.getDate() + i);
                const dStr = getLocalDateStr(d);
                const isToday = dStr === getLocalDateStr(new Date());
                html += `<div class="week-day ${isToday ? 'today' : ''}" onclick="selectDate('${dStr}')">
                    <div class="week-day-name">${dayNames[i]}</div>
                    <div class="week-day-num">${d.getDate()}</div>
                </div>`;
            }
            grid.innerHTML = html;
        }

        function selectDate(dStr) { state.selectedDate = dStr; renderWeeklyCalendar(); }

        function renderMemos() {
            const grid = document.getElementById('memoGrid');
            grid.innerHTML = state.memos.map((m, i) => `
                <div class="memo-postit ${m.color}">
                    <div class="memo-postit-title">${m.title}</div>
                    <div class="memo-postit-content">${m.content}</div>
                </div>
            `).join('') + `<div class="memo-postit" style="background:var(--bg-secondary); border:2px dashed var(--border); justify-content:center; align-items:center; color:var(--text-muted);" onclick="openAddMemo()">+</div>`;
        }

        function openAddMemo() { document.getElementById('memoModal').classList.add('active'); }
        function saveMemo(e) {
            e.preventDefault();
            state.memos.push({
                title: document.getElementById('memoTitle').value,
                content: document.getElementById('memoContent').value,
                color: document.getElementById('memoColorSelect').value
            });
            saveState(); renderMemos(); closeModal('memoModal');
        }

        function renderNewsKeywords() {
            document.getElementById('newsKeywords').innerHTML = state.newsKeywords.map(k => `
                <div class="news-keyword ${k === state.activeKeyword ? 'active' : ''}">${k}</div>
            `).join('');
        }

        function loadNews() {
            document.getElementById('newsList').innerHTML = '<div style="padding:20px; color:var(--text-muted); font-size:0.8rem;">Îâ¥Ïä§Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</div>';
        }

        function refreshNews() { loadNews(); }
        function exportToJson() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(state));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "dashboard_backup.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        init();
    </script>
</body>
</html>
